<!DOCTYPE html>
<html>
	<head>
		<title>Google Maps</title>
		<style type="text/css">
/* In order to use percent for height the html and body tags must be set to 100% height (I don't think width needs to be set)*/
html, body {
	width:100%; height:100%;
}
body {
	margin:0; padding:0;
}
#map-canvas {
	width: 90%;
	/*max-width:800px;*/
	height: 90%;
	/*max-height:400px;*/
	background-color: #CCCCCC;
	margin:0 auto;
	border: 2px solid #888;
}
		</style>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&amp;libraries=visualization,geometry&amp;sensor=true_or_false"></script>
		<script type="text/javascript" src="/js/js-marker-clusterer/markerclusterer_compiled.js"></script>
		<script type="text/javascript">
// <![CDATA[
var mapSettings = {
	initialZoom: 7,
	minZoom: 5,
	maxZoom: 14,
	maxDistance: 200,
	clusterGridSize: 100
};
var radiusInMiles = 6378137 * 0.000621371192;
function initialize() {
	// var mapCanvas = document.getElementById('map-canvas');
	var mapCanvas = $('#map-canvas')[0];
	var mapOptions = {
		center: new google.maps.LatLng(47,-103),
		zoom: mapSettings.initialZoom,
		minZoom: mapSettings.minZoom,
		maxZoom: mapSettings.maxZoom,
		mapTypeId: google.maps.MapTypeId.TERRAIN
	}
	var map = new google.maps.Map(mapCanvas, mapOptions);

	$('#test').click(function(e) {
		e.preventDefault();
		window.console && console.log('button clicked',e);
	});

	$.ajax({
		url: 'JSON/fn-outages.json',
		success: function (result) {

			var markers = [];
			for (var i = 0, outage; outage = result.outages[i]; i++) {
				var distanceFromNearestPoint = null;
				var currentPoint = new google.maps.LatLng(outage.latitude,outage.longitude);

				for (var j = 0, otherOutage; otherOutage = result.outages[j]; j++) {
					// Only calculate distance when the points are not the same.
					if (i !== j) {
						var otherPoint = new google.maps.LatLng(otherOutage.latitude,otherOutage.longitude);
						var distanceBetweenPoints = google.maps.geometry.spherical.computeDistanceBetween(currentPoint, otherPoint);

						if (distanceFromNearestPoint === null || distanceBetweenPoints < distanceFromNearestPoint) {
							distanceFromNearestPoint = distanceBetweenPoints;
						}
					}
				}
				window.console && console.log(i + ') distance to nearest: ', distanceFromNearestPoint);

				if (distanceFromNearestPoint < mapSettings.maxDistance) {
					var marker = new google.maps.Marker({position: currentPoint});
					markers.push(marker);
				}
			}

			var mcOptions = {gridSize: mapSettings.clusterGridSize, maxZoom: mapSettings.maxZoom};
			var mc = new MarkerClusterer(map, markers, mcOptions);
		}
	});
}

google.maps.event.addDomListener(window, 'load', initialize);

// $( document ).ready(function() {
// 	$('#test').click(function() {
// 		window.console && console.log('test');
// 	});
// });

// ]]>
		</script>
	</head>
	<body>
		<p>Google Map Test</p>
		<form action="none" id="addressForm" name="addressForm">
			<input type="text" id="address" name="address" />
			<button id="submitAddress" name="submitAddress" type="submit">Test</button>
		</form>
		<div id="map-canvas"></div>
		<p>footer</p>
	</body>
</html>
