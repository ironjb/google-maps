<!DOCTYPE html>
<html>
	<head>
		<title>Google Maps</title>
		<style type="text/css">
/* In order to use percent for height the html and body tags must be set to 100% height (I don't think width needs to be set)*/
html, body {
	width:100%; height:100%;
}
body {
	margin:0; padding:0;
}
#map-canvas {
	width: 90%;
	/*max-width:800px;*/
	height: 90%;
	/*max-height:400px;*/
	background-color: #CCCCCC;
	margin:0 auto;
	border: 2px solid #888;
}
		</style>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&amp;libraries=visualization,geometry&amp;sensor=true_or_false"></script>
		<script type="text/javascript" src="/js/js-marker-clusterer/markerclusterer_compiled.js"></script>
		<script type="text/javascript">
// <![CDATA[
var mapSettings = {
	initialZoom: 8,
	minZoom: 5,
	maxZoom: 14
};
var radiusInMiles = 6378137 * 0.000621371192;
function initialize() {
	// var mapCanvas = document.getElementById('map-canvas');
	var mapCanvas = $('#map-canvas')[0];
	var mapOptions = {
		center: new google.maps.LatLng(47,-103),
		zoom: mapSettings.initialZoom,
		minZoom: mapSettings.minZoom,
		maxZoom: mapSettings.maxZoom,
		mapTypeId: google.maps.MapTypeId.TERRAIN
	}
	var map = new google.maps.Map(mapCanvas, mapOptions);

	$.ajax({
		url: 'JSON/fn-outages.json',
		success: function (result) {

			var markers = [];
			for (var i = 0, outage; outage = result.outages[i]; i++) {
				var distanceFromNearestPoint = 100000000000000;
				var currentPoint = new google.maps.LatLng(outage.latitude,outage.longitude);

				for (var j = 0, otherOutage; otherOutage = result.outages[j]; j++) {
					// Only calculate distance when the points are not the same.
					if (i !== j) {
						var otherPoint = new google.maps.LatLng(otherOutage.latitude,otherOutage.longitude);
						var distanceBetweenPoints = google.maps.geometry.spherical.computeDistanceBetween(currentPoint, otherPoint);

						if (distanceBetweenPoints === 0) {
							// window.console && console.log('[' + i + ',' + j + ']');
							// window.console && console.log(currentPoint, otherPoint);
						}
						if (distanceBetweenPoints < distanceFromNearestPoint) {
							// window.console && console.log('old distance: ' + distanceFromNearestPoint);
							distanceFromNearestPoint = distanceBetweenPoints;
							// window.console && console.log('new distance: ' + distanceFromNearestPoint);
						}
					} else {
						// These are the same so don't do anything.
						// window.console && console.log('same points?:');
						// window.console && console.log(outage);
						// window.console && console.log(otherOutage);
					}
				}

				window.console && console.log(i + ') distance to nearest: ', distanceFromNearestPoint);

				if (distanceFromNearestPoint < 1000) {
					// var latLng = new google.maps.LatLng(outage.latitude, outage.longitude);
					var marker = new google.maps.Marker({position: currentPoint});
					markers.push(marker);
				}
			}

			var mcOptions = {gridSize: 100, maxZoom: mapSettings.maxZoom};
			var mc = new MarkerClusterer(map, markers, mcOptions);
			// var mc = new MarkerClusterer(map, markers);
		}
	});
}

google.maps.event.addDomListener(window, 'load', initialize);

// $( document ).ready(function() {
// 	$('#test').click(function() {
// 		window.console && console.log('test');
// 	});
// });

// ]]>
		</script>
	</head>
	<body>
		<p>Google Map Test</p>
		<button id="test" type="button">Test</button>
		<div id="map-canvas"></div>
		<p>footer</p>
	</body>
</html>
